<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tasty Tales</title>
    <link rel="icon" type="image/x-icon" href="assets\favicon_io (1)\favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/styles/style.css">
    <link rel="stylesheet" href="/css/styles/cuisine.css">
</head>
<style>
    .form-group{
        font-size: 13pt;
        color:black;
        font-weight: 500;
    }
    .form-control{
        border: 1px solid black;
    }
    .title{
        font-weight: 400;
        font-size: 20pt;
    }
</style>
<body>
    <%- include("./partials/header.ejs") %>



    <div class="container mt-5">
        <h1 class="text-center mb-4">Submit Your Recipe</h1>
        <div id="success-alert" class="alert alert-success d-none" role="alert">
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            Form submitted successfully!
        </div>
        <form id="recipe-form" method="POST"
        <% if(locals.modify){ %>
            action="/<%= cuisineName %>/update/?cuisine_id=<%= cuisineId  %>&item_id=<%= itemId %>"
            <% }else{ %>
                action="/<%= cuisineName %>/<%= varietyName %>/submit"
                <% } %>
                 enctype="multipart/form-data" onsubmit="myfunc()">
            <div class="form-group">
                <label for="recipe-title" class="pb-1">Recipe Title <span style="color:red; font-size: 20pt;">*</span></label>
                <input type="text" class="form-control title" id="recipe-title" name="recipeTitle" required
                <% if(locals.modify){ %>
                       value="<%= recipeTitle %>"
                    <% } %>
                    >
            </div>
            <div class="form-group mt-3">
                <label for="recipe-image" class="pb-1">Recipe Image <span style="color:red; font-size: 20pt;">*</span></label>
                <!-- <input type="url" class="form-control" id="recipe-image" name="recipe-image"> -->
                <input type="file" id="fileupload" name="recipeImage" accept="image/*"
                <% if(!locals.modify){ %>
                    required
                 <% }%>
                 >
            </div>
            <div class="form-group mt-3">
                <label for="cuisine-type" class="pb-1">Cuisine Type</label>
                <select class="form-control" id="cuisine-type" name="cuisine" required>
                    <option value="Indian"><%= cuisineName %> </option>
                        <!-- <option value="Italian">Italian</option>
                        <option value="Mexican">Mexican</option>
                        <option value="Chinese">Chinese</option>
                        <option value="American">American</option> -->
                </select>
                
            </div>
            <div class="form-group mt-3">
                <label for="ingredients" class="pb-1">Ingredients (one per line) <span style="color:red; font-size: 20pt;">*</span></label>
                <div id="line-numbers-instructions" class="line-numbers"></div>
                <textarea class="form-control floatingTextarea" id="ingredients" name="ingredients" rows="6" required 
                onkeydown="updateIngredients(event, `<%= modify %>`)">
<% if(modify){ %><% for(let i=0;i<ingredients.length;i++) {%><%= i+1 %>. <%= ingredients[i]%>
<% }; %><% } %></textarea>
            </div>
            <div class="form-group mt-3">
                <label for="instructions" class="pb-1">Directions (one step per line) <span style="color:red; font-size: 20pt;">*</span></label>
                <textarea class="form-control" id="instructions" name="instructions" rows="8" required onkeydown="updateInstructions(event,`<%= modify %>`)">
<% if(modify){ %><% for(let i=0;i<steps.length;i++) {%><%= i+1 %>. <%= steps[i]%>
<% }; %><% } %></textarea>
            </div>
            <div class="form-group mt-3">
                <label for="nutrition-facts" class="pb-1">Nutrition Facts</label>
                <textarea class="form-control" id="nutrition-facts" name="nutritionFacts" rows="4"></textarea>
            </div>
            <div class="form-group text-center mt-5">
                <button type="submit" class="btn btn-primary btn-lg">Submit Recipe</button>
            </div>
        </form>
    </div>

    <%- include ("./partials/footer.ejs") %>
  
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Domine:wght@400..700&display=swap" rel="stylesheet">
      <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Playball&display=swap" rel="stylesheet">
      <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playball&display=swap" rel="stylesheet">
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>




      <script>
    //     function updateIngredients(event){
    //         // if(modify){
    //         //     concatenatedResult= concatenatedResult.slice(0,-1);
    //         //     }
    //         var count=1;
    //         var userInput = document.getElementById("ingredients").value;
    //         for(let i=0;i<userInput.length;i++){
    //             if(userInput[i]=="\n"){
    //                 count++;
    //             }
    //         }
    //         if(event.key=="Enter" || userInput===""){
    //             if(userInput===""){
    //                 var concatenatedResult =  userInput + count +". " ; 
    //             }
    //             else{
    //                 count++;
    //             var concatenatedResult =  userInput +"\n"+ count +". " ;
    //             }
    //             // console.log(concatenatedResult);
    //             // concatenatedResult= concatenatedResult.slice(0,-1);
               
    //             // concatenatedResult= concatenatedResult.slice(0,-1);
    //             document.getElementById('ingredients').value = concatenatedResult;
    //             // console.log((count))
    //             count=count+1;
    //             if (event.keyCode === 13 && !event.shiftKey) {
    //     // Prevent the default behavior of inserting a newline
    //                 event.preventDefault();
        
    //     // Optionally, you can handle other behavior here (e.g., submit form)
    //     // For example, uncomment the line below to submit a form on Enter
    //     // this.form.submit();
    //   }
    //             // console.log(concatenatedResult.length)
    //         }
            
    //     }
    function updateIngredients(event,modify) {
        
      var textarea = document.getElementById("ingredients");
      var userInput = textarea.value;
      var count = 1;

      // Calculate the current line number
      for (let i = 0; i < userInput.length; i++) {
        if (userInput[i] == "\n") {
          count++;
        }
      }

      if (event.key === "Enter") {
        // Prevent the default behavior of inserting a newline
        event.preventDefault();

        // Insert the new line number
        var start = textarea.selectionStart;
        var end = textarea.selectionEnd;
        var beforeCaret = userInput.substring(0, start);
        var afterCaret = userInput.substring(end);
        if(modify=="false"){
            count++;
            // console.log("OK")
        }
        var newText = beforeCaret + "\n" + (count ) + ". " + afterCaret;

        // Set the new value and move the cursor to the correct position
        textarea.value = newText;
        textarea.selectionStart = textarea.selectionEnd = start + ("\n" + (count + 1) + ". ").length;
      } else if (userInput === "") {
        // Handle the case when the textarea is empty
        var newText = "1. ";
        textarea.value = newText;
        textarea.selectionStart = textarea.selectionEnd = newText.length;
      }
    }


        function updateInstructions(event,modify) {
      var textarea = document.getElementById("instructions");
      var userInput = textarea.value;
      var count = 1;

      // Calculate the current line number
      for (let i = 0; i < userInput.length; i++) {
        if (userInput[i] == "\n") {
          count++;
        }
      }

      if (event.key === "Enter") {
        // Prevent the default behavior of inserting a newline
        event.preventDefault();

        // Insert the new line number
        var start = textarea.selectionStart;
        var end = textarea.selectionEnd;
        var beforeCaret = userInput.substring(0, start);
        var afterCaret = userInput.substring(end);
        // console.log(!modify)
        if(modify=="false"){
            count++;
            // console.log("OK")
        }
        var newText = beforeCaret + "\n" + count + ". " + afterCaret;

        // Set the new value and move the cursor to the correct position
        textarea.value = newText;
        textarea.selectionStart = textarea.selectionEnd = start + ("\n" + (count+1) + ". ").length;
      } else if (userInput === "" && count === 1) {
        // Handle the case when the textarea is empty
        var newText = "1. ";
        textarea.value = newText;
        textarea.selectionStart = textarea.selectionEnd = newText.length;
      }
    }
        
        const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('success') === 'true') {
        document.getElementById('success-alert').classList.remove('d-none');
        setTimeout(()=>{
            document.getElementById('success-alert').classList.add('d-none');
        },3000);
    }

      </script>
</body>
</html>